using System.Collections;
using System.Collections.Generic;
using UnityEngine.UI;
using UnityEngine;

public class PowerSceneManeger : MonoBehaviour
{
    public static PowerSceneManeger Instance;
    string[] CharacterScript = new string[3];
    public Text textBox;
    public TextAsset textFile;
    public Image characterRenderer;
    public Sprite[] characterImgs;
    public int powerIndex = 0;
    float goodfeel = 0.0f;
    bool isGive = false;
    int BGMIndex = 0;

	// Use this for initialization
	void Awake ()
    {
        if (Instance == null)
            Instance = this;
        else if (Instance != this)
            Destroy(this.gameObject);

        if (textFile != null)
        {
            CharacterScript = (textFile.text.Split('\n'));
        }

        isGive = false;
        VisitPowercheck();
        SetTextBoxAndCharataImg();
        sortBGMNumber();

        if (SoundMrg.Instance.isBGMOff)
            SoundMrg.Instance.FadeBGM(true, BGMIndex);
    }

    void sortBGMNumber()
    {
        switch (powerIndex)
        {
            case 0:
                BGMIndex = 4;
                break;
            case 1:
                BGMIndex = 5;
                break;
            case 2:
                BGMIndex = 6;
                break;
            case 3:
                BGMIndex = 7;
                break;
            case 4:
                BGMIndex = 8;
                break;
            case 5:
                BGMIndex = 9;
                break;
        }
    }

    void VisitPowercheck()
    {
        InGameMrg_Main.inGame_mrg_main.isVisitPower = true;
        InGameMrg_Main.inGame_mrg_main.visitPowerIndex = powerIndex;
        DataMrg.dataMrg.powerInfo[powerIndex].isVisit = true;
    }

    void SetTextBoxAndCharataImg()
    {
        goodfeel = ((float)(int)(1000 / (float)DataMrg.dataMrg.powerInfo[powerIndex].maxVolume) * DataMrg.dataMrg.OutData(int.Parse("2" + powerIndex.ToString()))) / 1000;
        Debug.Log("good : " + goodfeel);

        if (goodfeel >= 0.3 && goodfeel <= 0.8)
        {
            textBox.text = CharacterScript[0] + "\n" + CharacterScript[1];
        }
        else if (goodfeel > 0.8)
        {
            textBox.text = CharacterScript[2] + "\n" + CharacterScript[3];
        }
        else
        {
            textBox.text = CharacterScript[4] + "\n" + CharacterScript[5];
        }

        if (goodfeel >= 7.0f)
            characterRenderer.sprite = characterImgs[1];
        else if (goodfeel <= 4.0f || goodfeel >= 6.9f)
            characterRenderer.sprite = characterImgs[0];
        else
            characterRenderer.sprite = characterImgs[2];
    }
    

    public void GoToNextDay(int _num)
    {
        // SceneMrg.sceneMrg.NextScene(_num);
        SoundMrg.Instance.StartEFF(4);
        InGameMrg_Main.inGame_mrg_main.SetNextDay();
    }

    public void GiveMoney()
    {
        SoundMrg.Instance.StartEFF(3);
        float dumyMoney = DataMrg.dataMrg.OutData(11);
        if (!isGive)
        {
            if ((dumyMoney -= 10) <= 0)
            {

            }
            else
            {
                DataMrg.dataMrg.InputData(11, 10);  // 한번 기부할 때마다 골드 20감소
                DataMrg.dataMrg.InputData(int.Parse("2" + powerIndex.ToString()), 1);  // 기부할때마다 맥스값으 10퍼센트씩 호감도 증가
                isGive = true;
                textBox.text = CharacterScript[6];
            }
        }
        else
            textBox.text = CharacterScript[7];
        // DataUIMrg.Instance.setDisplayData();    // 데이터를 다시 Display
    }

}
