using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.UI;

public class MainUIMrg : MonoBehaviour
{
    public static MainUIMrg Instance;

    public GameObject[] powerBarSilder = new GameObject[6];
    public GameObject powerReport;
    public GameObject letter;           // 편지
    public GameObject letterHead;       // 편지지
    public Text contentsText;           // 편지 내용
    public Image powerMark;
    public Text leaderName;
    public Transform mainCamera;
    Vector3 startVector;
    Vector3 sideVector;
    float smooth = 3.0f;
    bool isSelect = false;

    void Awake()
    {
        if (Instance == null)
            Instance = this;
        else if (Instance != this)
            Destroy(this.gameObject);

        startVector = mainCamera.position;
        sideVector = new Vector3(18.43f, 0f,-10f);
    }

    void Start()
    {
        mainCamera.position = startVector;
        Invoke("SetDisplayUI", 0.02f);  // 로딩 때 컨텐츠가 로딩되고 IngameMrg가 퀘스트를 받오기까지의 딜레이를 기다린다.
        InGameMrg_Main.inGame_mrg_main.CallSetPowerReport();
    }


    public void SetDisplayUI()
    {
        letter.active = true;
        contentsText.text = InGameMrg_Main.inGame_mrg_main.Quest.contents;
        powerMark.sprite = DataMrg.dataMrg.powerInfo[InGameMrg_Main.inGame_mrg_main.Quest.powerNum].powerMark;
        leaderName.text = DataMrg.dataMrg.powerInfo[InGameMrg_Main.inGame_mrg_main.Quest.powerNum].leaderName;
        DataUIMrg.Instance.setDisplayData();    // 데이터를 다시 Display
    }

    public void OpenLeteer()
    {
        letter.active = false;
        letterHead.active = true;
    }

    public void AanswerLetter(bool _answer)
    {
        InGameMrg_Main.inGame_mrg_main.SetAnwserData(_answer);
        letterHead.active = false;
        MoveCameraLeft();
    }

    public void LoadPowerScene(int _Num)
    {
        SceneMrg.sceneMrg.NextScene(_Num);
    }

    public void SetPowerReport(int _powerIndex)
    {
        float value = 0.0f;

        value = ((float)(int)(1000 / (float)DataMrg.dataMrg.powerInfo[_powerIndex].maxVolume) * DataMrg.dataMrg.OutData(int.Parse("2" + _powerIndex.ToString()))) / 1000;
        DataMrg.dataMrg.powerReportData[_powerIndex] = value;

        for (int i = 0; i < 6; i++)
            powerBarSilder[i].transform.localScale = new Vector3(DataMrg.dataMrg.powerReportData[i], powerBarSilder[i].transform.localScale.y, powerBarSilder[i].transform.localScale.z);
    }

    public void ShowPowerReport()
    {
        powerReport.active = true;
    }

    public void ExitPowerReport()
    {
        powerReport.active = false;
    }

    public void MoveCameraLeft()
    {
        StartCoroutine(MoveLeft());
    }
    
    IEnumerator MoveLeft()
    {
        while (mainCamera.position.x <= sideVector.x-0.01)
        {
            mainCamera.transform.position = Vector3.Lerp(new Vector3(mainCamera.transform.position.x,0, mainCamera.transform.position.z), sideVector, Time.deltaTime * smooth);
            yield return new WaitForSeconds(0.005f);
        }
    }
}
