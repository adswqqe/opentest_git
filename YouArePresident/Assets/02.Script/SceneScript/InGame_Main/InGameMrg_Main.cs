using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.UI;

public class InGameMrg_Main : MonoBehaviour
{
    public static InGameMrg_Main inGame_mrg_main;

    public EventContents Quest;
    public bool isVisitPower = false;
    public int visitPowerIndex = -99;
    void Awake()
    {
        if (inGame_mrg_main == null)
            inGame_mrg_main = this;
        else if (inGame_mrg_main != this)
            Destroy(this.gameObject);

        DontDestroyOnLoad(this.gameObject);
    }

    void Start()
    {
        SetQuset();
    }

    public void SetNextDay()
    {
        SetQuset();
        // CallSetPowerReport();
    }

    public void CallSetPowerReport()
    {
        if (isVisitPower)
        {
            MainUIMrg.Instance.SetPowerReport(visitPowerIndex);
            isVisitPower = false;
            visitPowerIndex = -99;
        }
    }

    void SetQuset()
    {
        Quest = DataMrg.dataMrg.SetContentsData();
    }

    public void SetAnwserData(bool _anwser)
    {
        //int _spendGold, spendDay, upVolume, downVolume;
        //string whatPowerUp, whatPowerDown;

        //////// 수락했을 경우의 호감도가 오르는 세력들
        char[] YupPowerArr = new char[6];
        string[] YupPowerArrData = new string[6];
        int YupCount = 0;
        //////// 수락했을 경우의 호감도가 내려가는 세력들
        char[] YdownPowerArr = new char[6];
        string[] YdownPowerArrData = new string[6];
        int YdownCount = 0;
        // 거절했을 경우의 호감도가 내려가는 세력들
        char[] NdownPowerArr = new char[6];
        string[] NdownPowerArrData = new string[6];
        int NdownCount = 0;
        // 거절했을 경우의 호감도가 내려가는 세력들
        char[] NupPowerArr = new char[6];
        string[] NupPowerArrData = new string[6];
        int NupCount = 0;

        //////// 수락했을 경우의 호감도가 오르는 세력들
        for (int i = 0; i < Quest.YwhatPowerUp.Length; i++)
        {
            if (Quest.YwhatPowerUp[i] != ',' && Quest.YwhatPowerUp[i] != '.')
            {
                YupPowerArr[YupCount] = Quest.YwhatPowerUp[i];
                YupPowerArrData[YupCount] = "2" + YupPowerArr[YupCount];
                YupCount++;
            }
        }
        //////// 수락했을 경우의 호감도가 내려가는 세력들
        for (int i = 0; i < Quest.YwhatPowerDown.Length; i++)
        {
            if (Quest.YwhatPowerDown[i] != ',' && Quest.YwhatPowerDown[i] != '.')
            {
                YdownPowerArr[YdownCount] = Quest.YwhatPowerDown[i];
                YdownPowerArrData[YdownCount] = "2" + YdownPowerArr[YdownCount];
                YdownCount++;
            }
        }

        // 거절했을 경우의 호감도가 내려가는 세력들
        for (int i = 0; i < Quest.NwhatPowerDown.Length; i++)
        {
            if (Quest.NwhatPowerDown[i] != ',' && Quest.NwhatPowerDown[i] != '.')
            {
                NdownPowerArr[NdownCount] = Quest.NwhatPowerDown[i];
                NdownPowerArrData[NdownCount] = "2" + NdownPowerArr[NdownCount];
                NdownCount++;
            }
        }

        // 거절했을 경우의 호감도가 내려가는 세력들
        for (int i = 0; i < Quest.NwhatPowerUp.Length; i++)
        {
            if (Quest.NwhatPowerUp[i] != ',' && Quest.NwhatPowerUp[i] != '.')
            {
                NupPowerArr[NupCount] = Quest.YwhatPowerUp[i];
                NupPowerArrData[NupCount] = "2" + NupPowerArr[NupCount];
                NupCount++;
            }
        }

        ///////////////////////////////////////////////////////////////////
        // 수락했을 경우의 처리
        if (_anwser)
        {
            DataMrg.dataMrg.InputData(10, Quest.YspendDay);
            DataMrg.dataMrg.InputData(11, Quest.YspendGold);

            // 호감도 업
            for (int i = 0; i < YupCount; i++)
                DataMrg.dataMrg.InputData(int.Parse(YupPowerArrData[i]),Quest.YupVolume);
            // 호감도 다운
            for (int i = 0; i < YdownCount; i++)
            {
                Debug.Log("i = " + i + "" + YdownPowerArrData[i] + "" + -Quest.YdownVolume);
                DataMrg.dataMrg.InputData(int.Parse(YdownPowerArrData[i]), -Quest.YdownVolume);
            }
        }
        // 거절했을 경우의 처리
        else
        {
            DataMrg.dataMrg.InputData(10, Quest.NspendDay);
            DataMrg.dataMrg.InputData(11, Quest.NspendGold);

            // 호감도 업
            for (int i = 0; i < NupCount; i++)
                DataMrg.dataMrg.InputData(int.Parse(NupPowerArrData[i]), Quest.NupVolume);
            // 호갑도 다운
            for (int i = 0; i < NdownCount; i++)
                DataMrg.dataMrg.InputData(int.Parse(NdownPowerArrData[i]), -Quest.NdownVolme);
        }
    }
}
