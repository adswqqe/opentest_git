using System.Collections;
using System.Collections.Generic;
using UnityEngine.UI;
using UnityEngine;

public class EndingManager : MonoBehaviour
{
    public Sprite[] Ending_sprite = new Sprite[3];
    public Image Ending_img;
    public Text Ending_text;
    public TextAsset textFile;

    public string[] textline;
    float[] foresData = new float[6];
    float averageFeeling = 0.0f;
	// Use this for initialization
	void Awake()
    { 
		if(textFile != null)
        {
            textline = (textFile.text.Split('\n'));
        }

        DecisionEnding();
    }
	
    void DecisionEnding()
    {
        for (int i = 0; i < 6; i++)
        {
            foresData[i] = DataMrg.dataMrg.OutData(int.Parse("2" + i.ToString()));
            averageFeeling += foresData[i];
            Debug.Log(i + "번쨰 세력 호감도 : " + foresData[i]);
        }

        if (foresData[0] <= 10.0f)
        {
            SoundMrg.Instance.FadeBGM(true, 2);
            Ending_img.sprite = Ending_sprite[0];
            Ending_text.text = textline[0];
        }
        else if (averageFeeling >= 60.0f)
        {
            SoundMrg.Instance.FadeBGM(true, 1);
            Ending_img.sprite = Ending_sprite[1];
            Ending_text.text = textline[2];
        }
        else if (DataMrg.dataMrg.hasYesNo[38] == 1 && DataMrg.dataMrg.hasYesNo[11] == 0 && foresData[2] <= 1.0f)
        {
            SoundMrg.Instance.FadeBGM(true, 3);
            Ending_img.sprite = Ending_sprite[3];       // 세력 3 엔딩씬이 3번
            Ending_text.text = textline[6];
        }
        else if (foresData[1] <= 4 && DataMrg.dataMrg.hasYesNo[55] == 1)
        {
            SoundMrg.Instance.FadeBGM(true, 3);
            Ending_img.sprite = Ending_sprite[4];       // 세력2 엔딩씬이 4번
            Ending_text.text = textline[8];
        }
        else if (foresData[3] >= 10)
        {
            SoundMrg.Instance.FadeBGM(true, 3);
            Ending_img.sprite = Ending_sprite[5];       // 세력4 엔딩씬이 5번
            Ending_text.text = textline[10];
        }
        else if (foresData[5] <= 3 && DataMrg.dataMrg.hasYesNo[53] == 1)
        {
            SoundMrg.Instance.FadeBGM(true, 3);
            Ending_img.sprite = Ending_sprite[6];       // 세력6 엔딩씬이 6번
            Ending_text.text = textline[12];
        }
        else if (foresData[0] >= 40 && foresData[4] <= 2.5f)
        {
            SoundMrg.Instance.FadeBGM(true, 3);
            Ending_img.sprite = Ending_sprite[7];       // 세력5 엔딩씬이 7번
            Ending_text.text = textline[14];
        }
        else
        {
            SoundMrg.Instance.FadeBGM(true, 3);
            Ending_img.sprite = Ending_sprite[2];
            Ending_text.text = textline[4];
        }

    }

    public void Back2Title()
    {
        DataMrg.dataMrg.DataInitialization();
        SceneMrg.sceneMrg.NextScene(0);
    }
}
